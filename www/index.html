<!DOCTYPE html>
<html>
<!-- 
The MIT License (MIT)

Copyright (c) 2014 Cleyton Slaviero

Permission is hereby granted, free of charge, to any person obtaining a copy
of this software and associated documentation files (the "Software"), to deal
in the Software without restriction, including without limitation the rights
to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
copies of the Software, and to permit persons to whom the Software is
furnished to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be included in all
copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
SOFTWARE.
-->
<head>	
	<meta charset="utf-8">
	<meta name="format-detection" content="telephone=no" />
	<meta name="viewport" content="user-scalable=no, initial-scale=1, maximum-scale=1, minimum-scale=1, target-densitydpi=device-dpi" />

	<title>IHC 14</title>

	<link rel="stylesheet" href="css/index.css">
	<link rel="stylesheet" href="lib/jquery-mobile/css/jquery.mobile-1.4.0.min.css" />
	<!-- JQUERY -->
	<script type="text/javascript" src="lib/jquery/jquery.js"> </script>
	<!-- CORDOVA -->
	<script type="text/javascript" src="cordova.js"></script>

	<script type="text/javascript" src="lib/jquery-mobile/js/jquery-1.11.0.min.js"></script>

	<script type="text/javascript" src="lib/jquery-mobile/js/jquery.mobile-1.4.0.min.js"></script>
	<script type="text/javascript" src="js/index.js"></script>
</head>
<!-- CARREGAR SCRIPTS PRA CADA PAGINA AQUI -->
	<!-- <script type="text/javascript" src="js/program_day_detail.js"></script>
	<script type="text/javascript" src="js/favorites.js"></script> -->
	<!-- <script type="text/javascript" src="js/keynote.js"></script> -->
	<!-- <script type="text/javascript" src="js/program_detail.js"></script> -->
	<!-- <script type="text/javascript" src="js/program_day_detail.js"></script> -->
<script type="text/javascript">

				// First, checks if it isn't implemented yet.
		
		if (!String.prototype.format) {
		// does it  receive arguments?
		  String.prototype.format = function() {
		    var args = arguments;
		    return this.replace(/{(\d+)}/g, 
		    	function(match, number) { 
		      		return typeof args[number] != 'undefined' ? args[number]: match;
		    	});
		  };
		}

		function compare(startTime,endTime,timeSchedule){
			console.log("compare");
			// verifica se o horário está dentro do timeSchedule
			// pra isso preciso dar split neles e fazer a comparação
			var splitStartTime = startTime.split(":");
			var splitEndTime = endTime.split(":");
			var splitTimeSchedule = timeSchedule;

			// agora preciso comparar 
			
			// regras
			// se startTime >= timeSchedule, retorna true
			// se endTime é estritamente maior que timeSchedule, retorna true
			if (splitStartTime[0] >= splitTimeSchedule){
				return true;
			}else{
				if (splitEndtTime[0] > splitTimeSchedule){
					return true;
				}else{
					// não deu.
					return false;
				}
			}
		}


		function addEvent(hour,list){
			var endLi = '</li>';
			var startLiLine = '<li class="line">';
			var startA = '<a href="#program_detail" onclick="fill_program_detail('+"'{0}"+"',"+'{1});" data-transition="pop" >';

			//console.log("addEvent");
			
			var res = "";
			// insertBefore
			var h = "#h_"+hour;
			for (var ind=0; ind<list.length; ind++){
				var data = list[ind];
				/*console.log('event: '+ind);*/

			/*	if (compare(data.startTime,data.endTime,hour)){*/
					//console.log("entrouEventCompare");
					// cria a entrada
					res = res+startLiLine;
					res = res+startA.format(data.id_event,"'event'");
							// nome do evento
					res=res+'<p>'+data.title+'</p>'+ 
							'<p>'+data.description+'</p>'+ 
							// local
	    					'<p><strong>'+data.location+'</strong></p>'+ 
	    					//hora do evento
	    					// (ToDo: e se for evento que começou mais cedo?)
	    					'<p class="ui-li-aside"><strong>'+data.startTime+"-"+data.endTime+'</strong></p>'; 
					res = res+"</a>"+endLi;

			/*res = res + '<li class="line">'+
				    		'<a href="#program_detail" onclick="fill_program_detail();" data-transition="pop" >'+
					    		'<h2>Sessao Técnica 1</h2>'+
					    		'<p>Aspectos Culturais em IHC e Semiótica</p>'+
					    		'<p><strong>Sala 1 - Auditorio Apagão</strong></p>'+
					    		'<p class="ui-li-aside"><strong>10:00-12:00</strong></p>'+
		    				'</a>'+
		    			'</li>';*/

				/*}*/
				
			}

			/*console.log("res: "+res);*/
			console.log(hour);
			$("#h_"+hour.split(":")[0]).before(res);
			

		}

		function addProgram(hour,list){
			//console.log("addProgram");
			var endLi = '</li>';
			var startLiLine = '<li class="line">';
			var startA = '<a href="#program_detail" onclick="fill_program_detail('+"'{0}"+"',"+'{1});" data-transition="pop" >';

			// dou um replace na hora 
			//(mas qual é a hora que eu estou querendo dar replace?)

/*		for (var i=0; i<list.length; i++){
				console.log('program '+i);
				var data = list[i];
				if (compare(data.startTime,data.endTime,hour)){
						//console.log('compareOKProgram');
						// cria a entrada	
						res = res+startLiLine;
						res = res+startA.format(data.id_program,'program');
						// tipo de programa
						res=res+'<h2>'+data.type+'</h2>'+
						// nome do programa
						'<p>'+data.name+'</p>'+
						// local do programa
		    			'<p><strong>'+data.location+'</strong></p>'+ 
		    			//hora do programa
		    			'<p class="ui-li-aside"><strong>'+data.startTime+"-"+data.endTime+'</strong></p>';
						//fecha a
						res = res+"</a>"+endLi;
				}
			}*/
			// insertBefore

			$("#h_"+hour).before(res);
			$("ul").listview('refresh');
		}

		function addScheduleByDay(hour,day,typeSchedule){

			var hora = hour;

			// funcão que retorna uma key value com os dados do banco
			var selectEvent = "SELECT * FROM event where date=?";
			var selectProgram = "SELECT * FROM program where date=?";

			var usedSelect;

			if (typeSchedule=='program') {
				usedSelect=selectProgram;
			}else{
				if(typeSchedule=='event'){
					usedSelect = selectEvent;
				}
			}

			function success(tx,results){
				
				var listEvent= new Array();
				var listProgram = new Array();
				var isEvent = true;

				// results is a http://dev.w3.org/html5/webdatabase/#sqlresultset
				var res = new Array();
				
				// percorra a lista de resultados...
				for (var i=0; i < results.rows.length; i++){
			       var item = results.rows.item(i);
			       // adicione em uma lista que vamos inserir lá no div.
			       if (item.id_event){


			       	listEvent.push(item);	
			       	isEvent=true;
			       }else{
			       	if(item.id_program){
			       		listProgram.push(item);
			       		isEvent=false;
			       	}
			       }
			    }
			    //bela gambiarra, irei arrumar depois se tudo funcionar.
			    // tenho que criar uma função pra cada candango.
			    /*console.log(listEvent);*/
			    /*console.log(listProgram);*/
			    if (isEvent){
			    	addEvent(hour,listEvent);	
			    }else{
			    	addProgram(hour,listProgram);
			    }
			   // $("ul").listview('refresh');
			}

			var db = window.sqlitePlugin.openDatabase({name: "ihc.db"},function(tx,res){ /*console.log("deu BOM no banco");*/},function(tx,res){ console.log("deu RUIM no banco");});
			
			db.transaction(function (tx){
				tx.executeSql(usedSelect, [day], success,
			            function (tx,err){
			            	console.log("ERRORIHC: "+err.message);
			            });
			});
			
		}

		function fill_program_detail(id,type){

			// type pode ser program ou event. 
			//preencher dados em "program_detail" de acordo.
			// vou ter que fazer um select nested com outro, será que funciona?
			// se não funcionar, vou fazer um "prototipo" de página pra só preencher
			// e aí não tem problema, sincronismo não vai prejudicar.
			// vou ter que fazer isso mesmo!
		}

		function onLoad(){
			ihc.app.initialize();
		}

		function fill_presentation_detail(id_presentation)
		{	
			var techSession = "Technical Session";
			$("#presentation_detail_title").text(techSession);
			$("#pres_program_detail_type").html("<strong>"+techSession+"</strong>");
			$("#pres_program_detail_name").text("Education and Games");
			$("#presentation_name").text("Teacher's Presence Mediated by Virtual Learning Environment Interfaces: Evidences of the Self");
			$("#presentation_time").text("Horário: 08:00 - 18:00");
			$("#presentation_local").text("Local: Sala Apagão");
			$("#presentation_authors").append("Luciana Espindola<br>Milene Silveira");
			$("#presentation_abstract").append("<strong>Abstract:</strong><br>Not available.");
			
		}

		function fill_program_day_detail(day)
		{	
			// remove on final version
			var day = '10/27/2014';

			//program_day_detail_title
			//div_program_day_detail
			var startUl='<ul id="testUl" data-role="listview" data-inset="true" data-filter="true" class="ui-listview ui-listview-inset ui-corner-all ui-shadow">';
			var endUl= '</ul>';
			// ao final deste é preciso inserir horário
			var startLiHorario = '<li id="divider_dia" data-role="list-divider" role="heading" class="ui-li-divider ui-bar-inherit ui-first-child">';
			var endLi = '</li>';
			var startLiLine = '<li class="line">';
			var startA = '<a href="#program_detail" onclick="fill_program_detail('+"'{0}"+"',"+'{1});" data-transition="pop" >';


			//need to fill this in. (in the future from the database)
			var listDay = {"10/27/2014":{"08:30":"08:30-10:00",
										 "CB1":"10:00-10:30",
										 "10:30":"10:30-12:00",
										 "ALM":"12:00-14:00",
										 "14:00":"14:00-15:30",
										 "CB2":"15:30-16:00",
										 "16:00":"16:00-17:30"			 
										},
							"10/28/2014":{"08:00":"08:30-10:00"},
							};

			

			var listSchedule = listDay[day];

			var res = "";
			res = res+startUl;
			
			for (key in listSchedule) {
				
				// pra cada horário tem um Li
				var value = listSchedule[key];
				// cria a entrada de horário
				
				// se key == "CB"
				if (key=="CB1" || key=="CB2") {
					/*res = res+'<li id="divider_cb" data-role="list-divider"><strong>'+value+'</strong><center><strong>Coffe Break</strong></center></li>';*/
					res = res+'<li id="divider_cb" data-role="list-divider" role="heading" class="ui-li-divider ui-bar-inherit">'+value+' - Coffe Break';
				}
				else
				{
					// se key == "ALM"
					if (key=="ALM") {
						res = res+'<li id="divider_cb" data-role="list-divider" role="heading" class="ui-li-divider ui-bar-inherit">'+value+' - Lunch';
					}else{
						var hour = key.split(":")[0];
						res = res+startLiHorario+value+endLi;
						// se eu botar um div funfa? :D
						// crio o div pra "dar append"
						/*res = res+"<div id='h_"+hour+"'></div>"; */
						// vai atuar como um flag pra eu dar replaceWith depois
						res = res+"<div id='h_"+hour+"'></div>";  
						
						// preciso colocar isso fora.		
						/*addScheduleByDay(hour,day,'program');
						addScheduleByDay(hour,day,'event');*/

					}
				}

				// fecha liHorario
				res=res+endLi;
			}
			// fecha Ul da lista de horários
			res = res+endUl;
			$("#div_program_day_detail").html(res);
			// depois percorro de novo a lista de horários e preencho os divs de acordo. 
			// sincronismo MY ASS! MUHAHAHAHAHAHA
			for (key in listSchedule) {
				if (key != "CB1" && key != "CB2" && key != "ALM"){
					addScheduleByDay(key,day,'program');
					addScheduleByDay(key,day,'event');
				}
			}
			// POR QUE NAO FUNCIONA???
			/*$('.line').listview().listview('refresh');*/
			try{
				/*$("#testUl").trigger('create');*/
				/*$("#testUl").listview().listview('refresh');*/
				$('#program_day_detail').trigger('pagecreate');
			}catch (err){
				console.log('err1: '+err.message);
			}
			try{
				$('ul').enhanceWithin();
			}catch (err){
				console.log('err2: '+err.message);
			}
			/*$("ul").trigger('create');
			$(".line").trigger('create');*/
		}


		function fill_event_detail(id_event){
			/*event_title;
			event_detail_name;
			event_local;
			event_time;
			event_author;
			event_abstract;*/

		} 

		function teste(){
			$('#program_title').text('ST1 - Educação e Games');
		}



	</script>
	<style>
		#divider_dia {background-color:rgb(138,192,255);}
		#divider_cb {background-color:rgb(246,116,49);font-size: 1em; }
	</style>
<body onload="onLoad()">

<div data-role="page" id="home">

	<div data-role="header" data-position="fixed">
		<h1>IHC 2014</h1>
		<!-- <a href="#settings" data-icon="gear" data-transition="slideup" class="ui-btn-right">Configurar</a> -->
	</div>

	<div role="main" class="ui-content" id="home-content">
		<center><img src='icon.png'/></center>
		<!-- <p>Agora no IHC14:</p> -->
		<!-- <p>Sala 1:<div id="agora1"></div></p>
		<p>Sala 2:<div id="agora2"></div></p>
		<p>Sala 3:<div id="agora3"></div></p>
		<p>Sala 4:<div id="agora4"></div></p> -->
		<!-- <p><a id="teste" href="#" onclick="showAlert(); return false;">Atualizar dados (melhorar nome/botao)</a></p> -->		
		<a href="#favorites" class="ui-btn">Favorites</a>
		<p>
		<a href="#program" class="ui-btn">Program</a>
		<a href="#keynotes" class="ui-btn">Keynote Speakers</a>
		<a href="#comitee" class="ui-btn">Commitee</a>
		<a href="#about" class="ui-btn">About</a>
		<a href="#social_events" class="ui-btn">Social Events</a>
	</div>
</div>

<!--PROGRAM PAGE-->
<div data-role="page" id="program">

	<div data-role="header" data-position="fixed">
		<h1> <img src='icon.png' width="20px" height="20px"/> Program</h1>
		<a href="#home" data-icon="arrow-l" data-transition="slideup" class="ui-btn-left">Back</a>
		<!-- <a href="#settings" data-icon="gear" data-transition="slideup" class="ui-btn-right">Settings</a> -->
	</div>

	<div role="main" class="ui-content" id="home-content">
		<!-- Ver se eu posso usar o tal evento pagebeforeshow -->
		<!-- (se do jeito que tá der problema o que acho que não vai dar -->
		<!-- Basicamente fill_program_day_detail vai fazer um select em tudo em programa E evento que aconteça no dia pra cada faixa de horário (o que será melhor; fazer multiplas consultas no banco ou fazer for pra pegar eventos? acho que a consulta no banco é mais rapida do que meus for O(n^n) que eu vou fazer, risos) -->
		<a href="#program_day_detail" onclick="fill_program_day_detail('10/27/2014')" class="ui-btn">Monday, October 27th</a>
		<a href="#program_day_detail" onclick="fill_program_day_detail('10/28/2014')" class="ui-btn">Tuesday, October 28th</a>
		<a href="#program_day_detail" onclick="fill_program_day_detail('10/29/2014')" class="ui-btn">Wednesday, October 29th</a>
		<a href="#program_day_detail" onclick="fill_program_day_detail('10/30/2014')" class="ui-btn">Thursday, October 30th</a>
		<a href="#program_day_detail" onclick="fill_program_day_detail('10/31/2014')" class="ui-btn">Friday, October 31th</a>
	</div>
</div>
<script>
	function replace(){
		$("#repl").replaceWith('<li class="line"><a href="#program_detail" data-transition="pop"><h2>Sessao Técnica 1</h2><p>Aspectos Culturais em IHC e Semiótica</p><p><strong>Sala 1 - Auditorio Apagão</strong></p><p class="ui-li-aside"><strong>10:00-12:00</strong></p></a></li>');
		$("ul").listview('refresh');
	}
</script>

<div data-role="page" id="favorites">

	<div data-role="header" data-position="fixed">
		<h1>Favorites</h1>
		<a href="#home" data-icon="arrow-l" data-transition="slideup" class="ui-btn-left">Back</a>
	</div>
	<div role="main" class="ui-content" id="home-content">
		<button onclick="replace();">Replace</button>
		<ul id="favorites_listview" data-role="listview" data-inset="true" data-filter="true">
		<!-- Cada "list_divider" é gerado somente se há algum evento pra esta data nos favoritos (isso vai dar trabalho...)-->
		<!-- 27/OUTUBRO -->
	    	<li id="divider_dia" data-role="list-divider">Segunda, 27 de Outubro,2014</li>

	    	<li class="line">
	    		<a href="#program_detail" onclick="fill_program_detail('1');" data-transition="pop" >
	    		<h2>Sessao Técnica 1</h2>
	    		<p>Aspectos Culturais em IHC e Semiótica</p>
	    		<p><strong>Sala 1 - Auditorio Apagão</strong></p>
	    		<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    	</a></li>
	    	<div id="repl"></div>
	    	<li class="line">
	    		<a href="#program_detail" onclick="fill_program_detail('1');" data-transition="pop" >
	    		<h2>Evento Genérico 2</h2>
	    		<p>Educação e Games</p>
	    		<p><strong>Sala 1 - Auditorio Luz do Dia</strong></p>
	    		<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    	</a></li>
	    	<li id="divider_dia" data-role="list-divider">Terça, 28 de Outubro,2014 </span></li>
	    	<li class="line">
	    		<a href="#program_detail" onclick="fill_program_detail('1');" data-transition="pop" >
		    		<h2>Sessao Técnica 1</h2>
		    		<p>Aspectos Culturais em IHC e Semiótica</p>
		    		<p><strong>Sala 1 - Auditorio Apagão</strong></p>
		    		<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    		</a>
	    	</li>
	    	<li class="line">
	    		<a href="#program_detail" onclick="fill_program_detail('1');" data-transition="pop" >
		    		<h2>Evento Genérico 2</h2>
		    		<p>Educação e Games</p>
		    		<p><strong>Sala 1 - Auditorio Luz do Dia</strong></p>
		    		<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    		</a>
	    	</li>
		</ul>
	</div>
</div>


<!-- PROGRAM DAY Page -->
<div data-role="page" id="program_day_detail">
	<div data-role="header" data-position="fixed">
		<h1>Program by Day</h1>
		<a href="#program" data-icon="arrow-l" data-transition="slideup" class="ui-btn-left">Back</a>
	</div>
	
	<div role="main" class="ui-content">
		<button onclick="$('#testUl').enhanceWithin();">Refresh</button>
	    <h2 id="program_day_detail_title"> </h2>
	    <!-- AQUI dentro vai ser colocado as informações vindas do banco -->
	    <div id="div_program_day_detail"> 
		</div>
	</div>
</div>


<!-- PROGRAM_DETAIL PAGE -->
<div data-role="page" id="program_detail">
	<div data-role="header" data-position="fixed">
		<h1 id="program_title">Generic Text</h1>
		<a href="#program_day_detail" data-icon="arrow-l" data-transition="slideup" class="ui-btn-left">Back</a>
	</div>
	<div role="main" class="ui-content" id="home-content">
		<strong id="program_detail_type">Technical Session</strong>
		<br><span id="program_detail_name">1- Education and Games</span>
		<p></p>
		<strong>Presentation List:</strong>
	 <div id="div_program_day_detail"> 
	    <ul data-role="listview" data-inset="true" data-filter="true">
	    		<!-- <li data-role="list-divider">09:00-10:00</li> -->
	    		<li class="line" data-icon="false">
	    			<a href="#presentation_detail" onclick="fill_presentation_detail('1');" data-transition="pop" >
	    				<div style="width:80%;"><h3>Teacher's Presence Mediated by Virtual Learning Environment Interfaces: Evidences of the Self</h3></div>
						<p>Luciana Espindola<br>
						Milene Silveira </p>
	    				<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    			</a>
	    		</li>
	    		<li class="line" data-icon="false">
	    			<a href="#presentation_detail" onclick="fill_presentation_detail('2');" data-transition="pop" >
	    				<div style="width:80%;"><h3>Teacher's Presence Mediated by Virtual Learning Environment Interfaces: Evidences of the Self</h3></div>
						<p>Luciana Espindola<br>
						Milene Silveira </p>
	    				<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    			</a>
	    		</li>
	    		<li class="line" data-icon="false">
	    			<a href="#presentation_detail" onclick="fill_presentation_detail('1');" data-transition="pop" >
	    				<div style="width:80%;"><h3>Teacher's Presence Mediated by Virtual Learning Environment Interfaces: Evidences of the Self</h3></div>
						<p>Luciana Espindola<br>
						Milene Silveira </p>
	    				<p class="ui-li-aside"><strong>10:00-12:00</strong></p>
	    			</a>
	    		</li>
	    </ul>
	</div>
		<!-- Aqui eu puxo os dados pra preencher a página antes de abrir. -->
		<!-- <h2>Presentions in this "Event</h2>
		<h3>Teacher's Presence Mediated by Virtual Learning Environment Interfaces: Evidences of the Self</h3>
		Luciana Espindola<br>
		Milene Silveira -->
		
	</div>
	<!-- I could add a footer if I want. But I don't. Deal. With. It. -->
</div>

<!-- presentation_detail PAGE -->
<div data-role="page" id="presentation_detail">
	<div data-role="header" data-position="fixed">
		<h1 id="presentation_detail_title"></h1>
		<a href="#program_detail" data-icon="arrow-l" data-transition="slideup" class="ui-btn-left">Back</a>
	</div>
	<div role="main" class="ui-content" id="home-content">
		<div id="pres_program_detail_type"></div>
		<span id="pres_program_detail_name"></span>
		<p></p>
		<!-- Aqui eu puxo os dados pra preencher a página antes de abrir. -->
		<h3 id="presentation_name"></h3>
		<div id="presentation_authors"></div>
		<p>
		<div id="presentation_abstract"></div>
	</div>
</div>

<div data-role="page" id="event_detail">
	<div data-role="header" data-position="fixed">
		<h1 id="event_title">Event</h1>
		<a href="#program_detail" data-icon="arrow-l" data-transition="slideup" class="ui-btn-left">Back</a>
	</div>
	<div role="main" class="ui-content" id="home-content">
		<br><h2 id="event_detail_name">V Workshop de Ensino de IHC</h2>
		
		<p><div id="event_local">Local: Sala Apagão</div>
			<div id="event_time">Horário: 08:00 - 18:00</div>
		</p>
		<div id="event_author">
			<strong>Organizers:</strong><br>
			Clodis Boscarioli<br>
			S. Amelia Bim</div>
		<p>
		<div id="presentation_abstract">
			<strong>About:</strong>
			<br>More details at http://www.serg.inf.puc-rio.br.
		</div>
	</div>
	<!-- I could add a footer if I want. But I don't. Deal. With. It. -->
</div>

<script type="text/javascript" src="lib/fastclick/js/fastclick.js"></script>
<script type="text/javascript" src="lib/handlebars/js/handlebars-v1.3.0.js"></script>

</body>
</html>
